<script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html" />


<dom-module id="content-reader">
  <template>
      <iron-ajax
          id="catalogueReader"
          auto
          url="../content/content.json"
          handle-as="json"
          on-response="readData">
      </iron-ajax>

      <iron-ajax
              id="contentMainReader"
              url=""
              handle-as="text"
              on-response="readMainContent">
      </iron-ajax>

      <iron-ajax
              id="contentDetailReader"
              url=""
              handle-as="text"
              on-response="readDetailContent">
      </iron-ajax>
      <iron-request id="xhr"></iron-request>


      [[chapters]]
  </template>
    <script>
        Polymer({
          is : "content-reader",
          properties : {
            chapters : Array,
            mainData: Object,
            detailData: Object
          },
          readData: function(data){
            var myres = data.detail.response;
            this.chapters = myres.Chapters;
            myres.Chapters.forEach(function(curVal){
            console.log(curVal);
              this.$.contentMainReader.url = "/content/"+curVal+"/main.html";
              var requestOptions= this.$.contentMainReader.toRequestOptions()
              var ddd = this.$.xhr.send(requestOptions);
               // ddd.then(function(){console.log('then!!!');});
              //console.log(this.$.contentMainReader.toRequestOptions());
              //this.$.contentDetailReader.url = "/content/"+curVal+"/details.html";
              //this.$.contentDetailReader.generateRequest();
            },this);
          },

          readMainContent: function(data) {
          console.log('main');
          console.log(data);
          console.log(data.detail.xhr.response);


          },
          readDetailContent: function(data) {
          console.log('detail');
          console.log(data);

          }
        });
    </script>
</dom-module>